<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Malleable Cover Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #111;
      color: #fff;
      overflow-x: hidden;
    }
    
    /* ============================================
       LAYOUT
       ============================================ */
    
    .app {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    header {
      padding: 16px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    header h1 {
      font-size: 1rem;
      font-weight: 600;
    }
    
    .mode-toggle {
      display: flex;
      gap: 8px;
    }
    
    .mode-btn {
      padding: 6px 12px;
      background: transparent;
      border: 1px solid #444;
      border-radius: 4px;
      color: #888;
      font-size: 0.75rem;
      cursor: pointer;
    }
    
    .mode-btn.active {
      background: #333;
      color: #fff;
      border-color: #555;
    }
    
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* ============================================
       PREVIEW SECTION
       ============================================ */
    
    .preview-section {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background: #0a0a0a;
    }
    
    .preview-container {
      position: relative;
      width: 100%;
      max-width: 280px;
      aspect-ratio: 9 / 16;
    }
    
    /* The actual preview box */
    .preview {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
    }
    
    .preview-frame {
      position: absolute;
      inset: 0;
      border: 12px solid var(--frame-colour, #0E394F);
      pointer-events: none;
      z-index: 10;
    }
    
    .preview-media {
      position: absolute;
      inset: 12px;
      overflow: hidden;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .preview-media img,
    .preview-media video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .preview-placeholder {
      color: #444;
      font-size: 0.75rem;
      text-align: center;
      padding: 20px;
    }
    
    .preview-overlay {
      position: absolute;
      inset: 12px;
      display: flex;
      flex-direction: column;
      z-index: 20;
      pointer-events: none;
    }
    
    .preview-logo {
      padding: 16px 12px 8px;
      text-align: center;
    }
    
    .preview-logo img {
      height: 28px;
      width: auto;
      max-width: 75%;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.4));
    }
    
    .preview-logo .placeholder-logo {
      font-size: 1.125rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
      letter-spacing: 0.15em;
    }
    
    .preview-spacer {
      flex: 1;
    }
    
    .preview-articles {
      padding: 10px;
      background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
    }
    
    .preview-article {
      font-size: 0.5rem;
      font-weight: 600;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-bottom: 4px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    
    .preview-meta {
      display: flex;
      justify-content: space-between;
      padding: 6px 10px;
      font-size: 0.4rem;
      color: rgba(255,255,255,0.7);
      background: rgba(0,0,0,0.5);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* ============================================
       CONTROLS SECTION
       ============================================ */
    
    .controls-section {
      background: #1a1a1a;
      border-top: 1px solid #333;
      max-height: 50vh;
      overflow-y: auto;
    }
    
    .controls-section.expanded {
      flex: 1;
    }
    
    .control-group {
      padding: 12px 16px;
      border-bottom: 1px solid #222;
    }
    
    .control-group:last-child {
      border-bottom: none;
    }
    
    .control-label {
      display: block;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #666;
      margin-bottom: 8px;
    }
    
    /* File inputs */
    .file-input-wrap {
      position: relative;
    }
    
    .file-input-wrap input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    
    .file-input-btn {
      display: block;
      width: 100%;
      padding: 12px;
      background: #2a2a2a;
      border: 1px dashed #444;
      border-radius: 6px;
      color: #888;
      font-size: 0.8125rem;
      text-align: center;
    }
    
    .file-input-btn.has-file {
      border-style: solid;
      border-color: #4A90A4;
      color: #fff;
    }
    
    .file-input-btn-small {
      padding: 8px;
      font-size: 0.75rem;
    }
    
    /* Logo selector */
    .logo-selector {
      display: flex;
      gap: 8px;
    }
    
    .logo-btn-select {
      flex: 1;
      padding: 10px 8px;
      background: #2a2a2a;
      border: 2px solid #333;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .logo-btn-select.active {
      border-color: #0C6C9C;
      background: #1a2a35;
    }
    
    .logo-preview {
      font-size: 0.625rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      padding: 4px 8px;
      border-radius: 3px;
    }
    
    .logo-preview.dark-bg {
      background: #1a1a1a;
      color: #fff;
    }
    
    .logo-preview.light-bg {
      background: #f0f0f0;
      color: #1a1a1a;
    }
    
    .logo-label {
      font-size: 0.625rem;
      color: #888;
    }
    
    /* Text inputs */
    .text-input {
      width: 100%;
      padding: 10px 12px;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 4px;
      color: #fff;
      font-family: inherit;
      font-size: 0.875rem;
    }
    
    .text-input:focus {
      outline: none;
      border-color: #4A90A4;
    }
    
    .text-input::placeholder {
      color: #555;
    }
    
    /* Colour picker */
    .colour-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .colour-input {
      width: 44px;
      height: 44px;
      padding: 0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .colour-presets {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .colour-preset {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.15s;
    }
    
    .colour-preset:hover {
      transform: scale(1.1);
    }
    
    .colour-preset.active {
      border-color: #fff;
    }
    
    /* Two-column inputs */
    .input-row {
      display: flex;
      gap: 8px;
    }
    
    .input-row .text-input {
      flex: 1;
    }
    
    /* Articles list */
    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    /* ============================================
       EXPORT SECTION
       ============================================ */
    
    .export-section {
      padding: 16px;
      background: #111;
      border-top: 1px solid #333;
    }
    
    .export-btn {
      width: 100%;
      padding: 14px;
      background: #4A90A4;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-family: inherit;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
    }
    
    .export-btn:active {
      background: #3d7a8a;
    }
    
    .export-note {
      margin-top: 8px;
      font-size: 0.75rem;
      color: #666;
      text-align: center;
    }
    
    /* ============================================
       DESKTOP ADJUSTMENTS
       ============================================ */
    
    @media (min-width: 768px) {
      main {
        flex-direction: row;
      }
      
      .preview-section {
        flex: 1;
      }
      
      .preview-container {
        max-width: 320px;
      }
      
      .controls-section {
        width: 360px;
        max-height: none;
        border-top: none;
        border-left: 1px solid #333;
      }
      
      .export-section {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 360px;
        border-left: 1px solid #333;
      }
      
      .preview-frame {
        border-width: 10px;
      }
      
      .preview-media {
        inset: 10px;
      }
      
      .preview-overlay {
        inset: 10px;
      }
      
      .preview-logo img {
        height: 26px;
      }
      
      .preview-article {
        font-size: 0.5625rem;
      }
    }
    
    /* ============================================
       FULL SCREEN PREVIEW MODE
       ============================================ */
    
    .app.fullscreen .controls-section,
    .app.fullscreen .export-section,
    .app.fullscreen header {
      display: none;
    }
    
    .app.fullscreen .preview-section {
      background: #000;
    }
    
    .app.fullscreen .preview-container {
      max-width: none;
      width: 100%;
      height: 100%;
      max-height: 100vh;
    }
    
    .fullscreen-close {
      position: fixed;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.6);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 1.25rem;
      cursor: pointer;
      z-index: 100;
      display: none;
    }
    
    .app.fullscreen .fullscreen-close {
      display: block;
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    
    <header>
      <h1>Cover Generator</h1>
      <div class="mode-toggle">
        <button class="mode-btn active" onclick="setMode('edit')">Edit</button>
        <button class="mode-btn" onclick="setMode('preview')">Preview</button>
      </div>
    </header>
    
    <main>
      <section class="preview-section">
        <div class="preview-container">
          <div class="preview" id="preview">
            <div class="preview-frame" id="frame"></div>
            <div class="preview-media" id="media-container">
              <div class="preview-placeholder" id="placeholder">
                Tap to add cover image or video
              </div>
              <img id="preview-image" src="" alt="" style="display: none;">
              <video id="preview-video" src="" muted loop playsinline style="display: none;"></video>
            </div>
            <div class="preview-overlay">
              <div class="preview-logo">
                <img id="logo-img" src="" alt="MALLEABLE" style="display: none;">
                <span class="placeholder-logo" id="logo-placeholder">MALLEABLE</span>
              </div>
              <div class="preview-spacer"></div>
              <div class="preview-articles" id="articles-container">
                <div class="preview-article">Made: Emmaus Cross</div>
                <div class="preview-article">Found: Structural Colour</div>
                <div class="preview-article">Thinking: The Malleable Mind</div>
              </div>
              <div class="preview-meta">
                <span id="meta-edition">Edition 01</span>
                <span id="meta-date">February 2026</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <section class="controls-section" id="controls">
        
        <div class="control-group">
          <label class="control-label">Cover media</label>
          <div class="file-input-wrap">
            <input type="file" id="media-input" accept="image/*,video/*">
            <div class="file-input-btn" id="media-btn">Tap to select image or video</div>
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">Logo</label>
          <div class="logo-selector">
            <button class="logo-btn-select active" data-logo="white" onclick="selectLogo('white')">
              <span class="logo-preview dark-bg">MALLEABLE</span>
              <span class="logo-label">White (dark bg)</span>
            </button>
            <button class="logo-btn-select" data-logo="black" onclick="selectLogo('black')">
              <span class="logo-preview light-bg">MALLEABLE</span>
              <span class="logo-label">Black (light bg)</span>
            </button>
          </div>
          <p style="font-size: 0.6875rem; color: #555; margin-top: 8px;">Or upload custom:</p>
          <div class="file-input-wrap" style="margin-top: 4px;">
            <input type="file" id="logo-input" accept="image/png">
            <div class="file-input-btn file-input-btn-small" id="logo-btn">Choose PNG</div>
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">Frame colour</label>
          <div class="colour-row">
            <input type="color" class="colour-input" id="colour-input" value="#0E394F">
            <div class="colour-presets" id="presets">
              <div class="colour-preset active" style="background: #0E394F;" data-colour="#0E394F" title="Deep Teal"></div>
              <div class="colour-preset" style="background: #0C6C9C;" data-colour="#0C6C9C" title="Ocean Blue"></div>
              <div class="colour-preset" style="background: #2C77EE;" data-colour="#2C77EE" title="Bright Blue"></div>
              <div class="colour-preset" style="background: #8E9F3A;" data-colour="#8E9F3A" title="Olive"></div>
              <div class="colour-preset" style="background: #9C1C29;" data-colour="#9C1C29" title="Deep Red"></div>
              <div class="colour-preset" style="background: #BC6C67;" data-colour="#BC6C67" title="Dusty Pink"></div>
              <div class="colour-preset" style="background: #212121;" data-colour="#212121" title="Charcoal"></div>
            </div>
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">Edition details</label>
          <div class="input-row">
            <input type="text" class="text-input" id="edition-input" value="Edition 01" placeholder="Edition 01">
            <input type="text" class="text-input" id="date-input" value="February 2026" placeholder="Month Year">
          </div>
        </div>
        
        <div class="control-group">
          <label class="control-label">Featured articles</label>
          <div class="articles-list">
            <input type="text" class="text-input article-input" value="Made: Emmaus Cross" placeholder="Made: ...">
            <input type="text" class="text-input article-input" value="Found: Structural Colour" placeholder="Found: ...">
            <input type="text" class="text-input article-input" value="Thinking: The Malleable Mind" placeholder="Thinking: ...">
          </div>
        </div>
        
      </section>
    </main>
    
    <section class="export-section">
      <button class="export-btn" onclick="showExportHelp()">Screenshot Cover</button>
      <p class="export-note">Use Preview mode then screenshot</p>
    </section>
    
    <button class="fullscreen-close" onclick="setMode('edit')">Ã—</button>
    
  </div>

  <script>
    // Elements
    const app = document.getElementById('app');
    const frame = document.getElementById('frame');
    const mediaContainer = document.getElementById('media-container');
    const placeholder = document.getElementById('placeholder');
    const previewImage = document.getElementById('preview-image');
    const previewVideo = document.getElementById('preview-video');
    const logoImg = document.getElementById('logo-img');
    const logoPlaceholder = document.getElementById('logo-placeholder');
    const articlesContainer = document.getElementById('articles-container');
    const colourInput = document.getElementById('colour-input');
    const mediaInput = document.getElementById('media-input');
    const logoInput = document.getElementById('logo-input');
    const mediaBtn = document.getElementById('media-btn');
    const logoBtn = document.getElementById('logo-btn');
    const presets = document.getElementById('presets');
    
    // Logo paths (relative to tools folder, adjust if needed)
    const logoWhitePath = '../template/MALLEABLE-Logo-wh.png';
    const logoBlackPath = '../template/MALLEABLE-Logo-bl.png';
    let selectedLogo = 'white';
    
    // Logo selection
    function selectLogo(type) {
      selectedLogo = type;
      
      // Update button states
      document.querySelectorAll('.logo-btn-select').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.logo === type);
      });
      
      // Update preview
      const path = type === 'white' ? logoWhitePath : logoBlackPath;
      logoImg.src = path;
      logoImg.style.display = 'block';
      logoPlaceholder.style.display = 'none';
      
      // Clear custom upload state
      logoBtn.textContent = 'Choose PNG';
      logoBtn.classList.remove('has-file');
    }
    
    // Handle media upload
    mediaInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const url = URL.createObjectURL(file);
      placeholder.style.display = 'none';
      
      if (file.type.startsWith('video/')) {
        previewImage.style.display = 'none';
        previewVideo.style.display = 'block';
        previewVideo.src = url;
        previewVideo.play();
        mediaBtn.textContent = file.name;
      } else {
        previewVideo.style.display = 'none';
        previewImage.style.display = 'block';
        previewImage.src = url;
        mediaBtn.textContent = file.name;
      }
      mediaBtn.classList.add('has-file');
    });
    
    // Handle custom logo upload (overrides selector)
    logoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      logoImg.src = URL.createObjectURL(file);
      logoImg.style.display = 'block';
      logoPlaceholder.style.display = 'none';
      logoBtn.textContent = file.name;
      logoBtn.classList.add('has-file');
      
      // Clear selector state
      document.querySelectorAll('.logo-btn-select').forEach(btn => {
        btn.classList.remove('active');
      });
    });
    
    // Handle colour input
    colourInput.addEventListener('input', (e) => {
      setColour(e.target.value);
      clearPresetActive();
    });
    
    // Handle preset clicks
    presets.addEventListener('click', (e) => {
      const preset = e.target.closest('.colour-preset');
      if (!preset) return;
      const colour = preset.dataset.colour;
      setColour(colour);
      colourInput.value = colour;
      setPresetActive(preset);
    });
    
    function setColour(colour) {
      frame.style.borderColor = colour;
      document.documentElement.style.setProperty('--frame-colour', colour);
    }
    
    function setPresetActive(preset) {
      document.querySelectorAll('.colour-preset').forEach(p => p.classList.remove('active'));
      preset.classList.add('active');
    }
    
    function clearPresetActive() {
      document.querySelectorAll('.colour-preset').forEach(p => p.classList.remove('active'));
    }
    
    // Update meta text
    document.getElementById('edition-input').addEventListener('input', updateMeta);
    document.getElementById('date-input').addEventListener('input', updateMeta);
    
    function updateMeta() {
      document.getElementById('meta-edition').textContent = document.getElementById('edition-input').value || 'Edition';
      document.getElementById('meta-date').textContent = document.getElementById('date-input').value || 'Date';
    }
    
    // Update articles
    document.querySelectorAll('.article-input').forEach(input => {
      input.addEventListener('input', updateArticles);
    });
    
    function updateArticles() {
      const inputs = document.querySelectorAll('.article-input');
      articlesContainer.innerHTML = '';
      inputs.forEach(input => {
        if (input.value.trim()) {
          const div = document.createElement('div');
          div.className = 'preview-article';
          div.textContent = input.value;
          articlesContainer.appendChild(div);
        }
      });
    }
    
    // Mode switching
    function setMode(mode) {
      const buttons = document.querySelectorAll('.mode-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      
      if (mode === 'preview') {
        app.classList.add('fullscreen');
        buttons[1].classList.add('active');
      } else {
        app.classList.remove('fullscreen');
        buttons[0].classList.add('active');
      }
    }
    
    // Export help
    function showExportHelp() {
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      
      let instructions;
      if (isIOS) {
        instructions = '1. Tap "Preview" button above\n2. Press Side button + Volume Up\n3. Crop to the cover area\n4. Save as cover-composed.jpg';
      } else if (isMac) {
        instructions = '1. Click "Preview" button above\n2. Press Cmd+Shift+4\n3. Select the cover area\n4. Rename to cover-composed.jpg';
      } else {
        instructions = '1. Click "Preview" button above\n2. Press Win+Shift+S\n3. Select the cover area\n4. Save as cover-composed.jpg';
      }
      
      alert('Screenshot Instructions:\n\n' + instructions);
      setMode('preview');
    }
    
    // Tap on media area to trigger file input (mobile convenience)
    mediaContainer.addEventListener('click', () => {
      if (!previewImage.src && !previewVideo.src) {
        mediaInput.click();
      }
    });
    
    // Initialise
    setColour('#0E394F');
    selectLogo('white');
  </script>
</body>
</html>
